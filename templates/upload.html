<!DOCTYPE html>
<html>
<head>
    <title>Legal Document Summarizer</title>
    <style>
        #progress-container {
            width: 100%;
            background-color: #ddd;
            margin-top: 20px;
        }
        #progress-bar {
            width: 0%;
            height: 25px;
            background-color: #4CAF50;
            text-align: center;
            color: white;
        }
        #summary {
            margin-top: 20px;
            white-space: pre-wrap;
        }
        #loading {
            font-weight: bold;
            color: #333;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <h2>Upload Legal Document (PDF or TXT)</h2>
   <form id="uploadForm" enctype="multipart/form-data">
  <input type="file" name="document" required />
  <button type="submit">Summarize</button>
</form>

<p id="loading" style="display:none;">âš¡ Summarizing, please wait...</p>
<progress id="progressBar" value="0" max="100" style="display:none; width:100%;"></progress>
<div id="summary"></div>

<script>
  document.getElementById("uploadForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);

    // Show UI
    document.getElementById("loading").style.display = "block";
    document.getElementById("progressBar").style.display = "block";
    document.getElementById("progressBar").value = 0;
    document.getElementById("summary").innerText = "";

    // Use EventSource for SSE
    const response = await fetch("/", {
      method: "POST",
      body: formData,
    });

    const reader = response.body.getReader();
    const decoder = new TextDecoder("utf-8");

    let summaryText = "";

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;

      const chunk = decoder.decode(value, { stream: true }).trim();

      chunk.split("\n\n").forEach((line) => {
        if (line.startsWith("data:")) {
          const data = line.replace("data: ", "").trim();

          if (data === "DONE") {
            // Finished
            document.getElementById("loading").style.display = "none";
            return;
          } else if (!isNaN(data)) {
            // Progress update
            document.getElementById("progressBar").value = parseInt(data);
          } else {
            // Final summary text
            summaryText += data + " ";
            document.getElementById("summary").innerText = summaryText;
          }
        }
      });
    }
  });
</script>
</body>
</html>
